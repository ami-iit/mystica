<h1 align="left">mystica</h1>

<p align="left">
   <a href="https://github.com/ami-iit/mystica/blob/master/LICENSE"><img src="https://img.shields.io/github/license/ami-iit/mystica" alt="Size" class="center"/></a>
  <a href="https://github.com/ami-iit/mystica/actions/workflows/matlab_ci.yml"><img src="https://github.com/ami-iit/mystica/actions/workflows/matlab_ci.yml/badge.svg?branch=main" alt="CI"/></a>
</p>

**Multi bodY SimulaTor maxImal CoordinAtes**

**mystica** is a MATLAB library to simulate the kinematics and dynamics of multibody systems.
**mystica** computes the system evolution by modeling the problem using a state definition that we define _maximal_.
The _maximal_ representation consists of a set of _non-minimum_ variables ùê™ complemented by the holonomic constraint g(ùê™) = 0.

---

<p align="center">
  <b>:warning: REPOSITORY UNDER DEVELOPMENT :warning:</b>
  <br>The libraries implemented in this repository are still experimental, and we cannot guarantee a stable API.
</p>

---

### Table of Contents

- [:hammer: Dependencies](#hammer-dependencies)
- [:floppy\_disk: Installation](#floppy_disk-installation)
- [:rocket: Usage](#rocket-usage)
- [:gear: Contributing](#gear-contributing)
- [Citing this work](#citing-this-work)
- [Maintainer](#maintainer)


## :hammer: Dependencies

- [`MATLAB`](https://mathworks.com/)
- [`MATLAB Curve Fitting Toolbox`](https://ch.mathworks.com/products/curvefitting.html) for the [`smooth`](https://ch.mathworks.com/help/curvefit/smooth.html) function
- A MATLAB [supported compiler](https://mathworks.com/support/requirements/supported-compilers.html) for MEX-file compilation

Other requisites are:

- [`CasADi`](https://web.casadi.org/)
- [`yamlmatlab`](https://github.com/ewiger/yamlmatlab)

Both [`CasADi`](https://web.casadi.org/) and [`yamlmatlab`](https://github.com/ewiger/yamlmatlab) are downloaded and configured in the [Installation](#floppy_disk-installation) section.

## :floppy_disk: Installation

1. Clone the repo:

```cmd
git clone https://github.com/ami-iit/mystica.git
cd mystica
```

2. Run the [`install()`](install.m) function in **MATLAB**.

```matlab
install()
```
The [`install()`](install.m) function downloads [`mambaforge`](https://github.com/conda-forge/miniforge#mambaforge). [`mambaforge`](https://github.com/conda-forge/miniforge#mambaforge) is a package manager that downloads and configures our dependencies in a conda environment called `mystica`.
<details>
    <summary>If you already have <a href="https://github.com/conda-forge/miniforge#mambaforge"><code>mambaforge</code></a></summary>
    If you already have <a href="https://github.com/conda-forge/miniforge#mambaforge"><code>mambaforge</code></a> configured, you can call the <a href="install.m"><code>install()</code></a> function by defining the <code>mambaforge_prefix</code> value:
    <pre><code>install('mambaforge_prefix',&#60;your mambaforge path prefix&#62;)</code></pre>
</details>


‚ö†Ô∏è **Known issue**
For some versions of Ubuntu and MATLAB, MATLAB is not able to load the required libraries like CasADi (see [issue](https://github.com/ami-iit/mystica/issues/6)). A possible workaround is to launch `matlab` with LD_PRELOAD:
```
LD_PRELOAD=/usr/lib/x86_64-linux-gnu/libstdc++.so.6 matlab
```

## :rocket: Usage

Before every usage, remember to run the autogenerated MATLAB file called `deps/setup.m` to set up the `MATLABPATH`.

Alternatively, you can launch MATLAB from the terminal after activating the conda environment called `mystica`:

```cmd
conda activate mystica
matlab
```

Here's a snippet of code to simulate the kinematics of a 4-bar linkage mechanism:

```matlab
model = mystica.model.getModel4BarLinkage();
stgs = mystica.stgs.getDefaultSettingsSimKinRel(model);
data = mystica.runSimKinRel('model', model, 'stgs', stgs, 'mBodyPosQuat_0', model.getMBodyPosQuatRestConfiguration, 'nameControllerClass', 'mystica.controller.ExampleKinRel');
mystica.viz.visualizeKinRel('model', model, 'data', data, 'stgs', stgs)
```

Other examples can be found in the [examples directory](examples).

If you want to delve deeper into the code, we have prepared [this document](docs/nomenclature.md) as an entry point to explain and describe our variables.

## :gear: Contributing

**mystica** is an open-source project, and is thus built with your contributions. We strongly encourage you to open an issue with your feature request. Once the issue has been opened, you can also proceed with a pull-request. :rocket:

## Citing this work

If you find the work useful, please consider citing:

```bibtex
@ARTICLE{9793615,
  author={Bergonti, Fabio and Nava, Gabriele and Fiorio, Luca and L‚ÄôErario, Giuseppe and Pucci, Daniele},
  journal={IEEE Transactions on Robotics},
  title={Modeling and Control of Morphing Covers for the Adaptive Morphology of Humanoid Robots},
  year={2022},
  volume={38},
  number={5},
  pages={3300-3313},
  doi={10.1109/TRO.2022.3170281}}
```

## Maintainer

This repository is maintained by:

| | |
|:---:|:---:|
| [<img src="https://github.com/FabioBergonti.png" width="40">](https://github.com/FabioBergonti) | [@FabioBergonti](https://github.com/FabioBergonti) |

<p align="left">
   <a href="https://github.com/ami-iit/paper_bergonti_2022_tro_kinematics-control-morphingcovers/blob/master/LICENSE"><img src="https://img.shields.io/github/license/ami-iit/paper_bergonti_2022_tro_kinematics-control-morphingcovers" alt="Size" class="center"/></a>
  <a href="https://github.com/ami-iit/paper_bergonti_2022_tro_kinematics-control-morphingcovers/actions/workflows/matlab_ci.yml"><img src="https://github.com/ami-iit/paper_bergonti_2022_tro_kinematics-control-morphingcovers/actions/workflows/matlab_ci.yml/badge.svg?branch=main" alt="CI"/></a>
</p>
